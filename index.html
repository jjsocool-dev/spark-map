<!DOCTYPE html>
<html>
<head>
	<title>Cool Map of STL</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<style>
		  body { margin:0; padding:0; }
		  #map { position:absolute;  bottom:0; width:100%;height:90%; }
		  #header { position:absolute;  top:0; width:100%;height:100%; background-color: Purple;}
		  #headerTxt {color: green; text-align: center;}
	</style>
	
</head>
<body>
	<div id="header">
		<h1 id="headerTxt">Cool Map of STL</h2>
	</div>
	<div id="map"></div>

	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
	<script src="https://unpkg.com/@turf/turf@3.5.2/turf.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="data/stl-buildings.geojson" type="text/javascript"></script>
	<script src="osmtogeojson.js" type="text/javascript"></script>
	<script src="spark.js" type="text/javascript"></script>
	<script type="text/javascript">

		/* Map Variables */


		// Set URLs for the GeoJSONs we will be using
		var buildingsURL = "data/stl-buildings.geojson";
		
		// Create the map variable
		var map = L.map('map')
			.setView([38.6836, -90.1923], 12)
			.on('contextmenu', onRightClick);

		// Add OSM Tile Layer
		var osmTiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
      		}).addTo(map);

		var esriImagery = L.tileLayer('https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/16749/{z}/{y}/{x}').addTo(map);

		var mapboxImagery = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA').addTo(map);
		
		var buildingsLayer = addGJLayer(buildingsURL);

		// Add the layers to their layer group
		var baseMaps = {
			"OpenStreetMap": osmTiles,
			"ESRI Imagery": esriImagery,
			"Mapbox Imagery Labels": mapboxImagery
		};

		var overlayMaps = {
			"STL Buildings": buildingsLayer
		};

		var gjLayers = new L.LayerGroup();
		gjLayers.addTo(map);

		// Add a control to turn layers on and off
		var layerControl = L.control.layers(baseMaps, overlayMaps);
		map.addControl(layerControl);
		//L.control.layers(baseMaps, overlayMaps).addTo(map);

		// Let's add a button to go to OpenStreetMap using the visual extent
		// Let's add a button to go to OpenStreetMap using the visual extent
		L.Control.Button = L.Control.extend({
		    options: {
		        position: 'topleft'
		    },
		    onAdd: function (map) {
		        var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
		        var button1 = L.DomUtil.create('a', 'leaflet-control-button', container);
		        L.DomEvent.disableClickPropagation(button1);
		        L.DomEvent.on(button1, 'click', function(){
		            var osmURL = `https://www.openstreetmap.org/#map=${map.getZoom()}/${map.getCenter().lat}/${map.getCenter().lng}`;
		            window.open(osmURL, '_blank');
		        });

		        button1.innerHTML = '<img style="max-width:100%; max-height:100%" src="img/osm.png">';

		        var button2 = L.DomUtil.create('a', 'leaflet-control-button', container);
		        L.DomEvent.disableClickPropagation(button2);
		        L.DomEvent.on(button2, 'click', function(){
		        	if(map.getZoom() < 14) {
		        		alert("Please zoom in!")
		        	} else {
			        	var query = window.prompt("What do you want to query?",'["building"="yes"]');
			        	if (query == null || query == "") {
			        		//user cancelled
			        	} else {
								var bounds = map.getBounds();
								var overpassURL = `{ "type": "FeatureCollection", "generator": "overpass-ide", "copyright": "The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.", "timestamp": "2022-10-25T18:02:53Z", "features": [ { "type": "Feature", "properties": { "@id": "way/108704951", "addr:city": "Saint Louis", "addr:housenumber": "1301", "addr:postcode": "63103", "addr:state": "MO", "addr:street": "Olive Street", "amenity": "library", "building": "yes", "building:levels": "3", "email": "webmaster@slpl.org", "fax": "(314) 539-0393", "name": "St. Louis Central Public Library", "opening_hours": "Mo-Th 10:00-21:00; Fr-Sa 10:00-18:00; Su 13:00-17:00", "phone": "+1 314 241 2288", "website": "https://www.slpl.org/", "wheelchair": "yes", "wikidata": "Q7589673", "wikipedia": "en:St. Louis Public Library" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.1999795, 38.6305964 ], [ -90.1996538, 38.6305294 ], [ -90.1996642, 38.6304987 ], [ -90.199563, 38.6304779 ], [ -90.199461, 38.6304566 ], [ -90.199451, 38.6304859 ], [ -90.1991238, 38.6304176 ], [ -90.1991086, 38.6304621 ], [ -90.1990943, 38.6305038 ], [ -90.1990798, 38.6305461 ], [ -90.1991001, 38.6305504 ], [ -90.1990708, 38.6306366 ], [ -90.19898, 38.6309032 ], [ -90.1991381, 38.630936 ], [ -90.1991282, 38.630965 ], [ -90.1996185, 38.6310664 ], [ -90.1996273, 38.6310402 ], [ -90.1997905, 38.6310738 ], [ -90.1998974, 38.6307573 ], [ -90.1999125, 38.6307125 ], [ -90.1999385, 38.6307179 ], [ -90.1999503, 38.630683 ], [ -90.1999665, 38.6306354 ], [ -90.1999795, 38.6305964 ] ] ] }, "id": "way/108704951" }, { "type": "Feature", "properties": { "@id": "way/238588110", "addr:city": "Saint Louis", "addr:housenumber": "4234", "addr:postcode": "63107", "addr:state": "MO", "addr:street": "North Grand Avenue", "amenity": "library", "building": "public", "name": "St. Louis Public Library Divoll Branch", "operator": "St. Louis Public Library", "operator:type": "public", "phone": "314-534-0313", "website": "https://www.slpl.org/" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2116068, 38.6675666 ], [ -90.2116266, 38.6675556 ], [ -90.2116434, 38.6675671 ], [ -90.2116582, 38.6675707 ], [ -90.2116776, 38.6675723 ], [ -90.2116937, 38.6675681 ], [ -90.2117078, 38.6675608 ], [ -90.2117195, 38.6675498 ], [ -90.2117158, 38.6675838 ], [ -90.2117839, 38.6676121 ], [ -90.2118318, 38.6675456 ], [ -90.211865, 38.6675215 ], [ -90.2119452, 38.667487 ], [ -90.2119421, 38.6674058 ], [ -90.2118412, 38.6673556 ], [ -90.2117664, 38.6673184 ], [ -90.2117657, 38.6673017 ], [ -90.211754, 38.6672891 ], [ -90.2117362, 38.6672844 ], [ -90.2117195, 38.6672833 ], [ -90.2117034, 38.6672859 ], [ -90.211694, 38.6672928 ], [ -90.2115328, 38.6675205 ], [ -90.2115914, 38.6675221 ], [ -90.2115911, 38.6675393 ], [ -90.2115948, 38.6675535 ], [ -90.2116068, 38.6675666 ] ] ] }, "id": "way/238588110" }, { "type": "Feature", "properties": { "@id": "way/289299485", "addr:city": "Saint Louis", "addr:housenumber": "3650", "addr:postcode": "63108", "addr:state": "MO", "addr:street": "Lindell Boulevard", "amenity": "library", "building": "university", "ele": "164", "gnis:county_name": "St. Louis (city)", "gnis:feature_id": "2468073", "gnis:import_uuid": "57871b70-0100-4405-bb30-88b2e001a944", "gnis:reviewed": "no", "name": "Pius XII Memorial Library", "source": "USGS Geonames", "wikidata": "Q18619075", "wikipedia": "en:Pius XII Memorial Library" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2349939, 38.6363824 ], [ -90.2349215, 38.6365995 ], [ -90.2348923, 38.6365936 ], [ -90.2348797, 38.636591 ], [ -90.2347698, 38.6366392 ], [ -90.2347617, 38.6366648 ], [ -90.2347375, 38.6366423 ], [ -90.2346946, 38.6366268 ], [ -90.2346596, 38.6366213 ], [ -90.2346205, 38.6366245 ], [ -90.2346103, 38.6366304 ], [ -90.2345985, 38.6366373 ], [ -90.2345576, 38.636661 ], [ -90.2345299, 38.6366984 ], [ -90.2345295, 38.6367417 ], [ -90.2345545, 38.6367857 ], [ -90.2345784, 38.6368019 ], [ -90.2346192, 38.6368118 ], [ -90.2345934, 38.6368766 ], [ -90.2345078, 38.6368558 ], [ -90.2344868, 38.6369111 ], [ -90.2347071, 38.6369619 ], [ -90.2347363, 38.6369897 ], [ -90.2347724, 38.6370198 ], [ -90.2349277, 38.6370514 ], [ -90.2352504, 38.6371171 ], [ -90.2354635, 38.636478 ], [ -90.2349939, 38.6363824 ] ] ] }, "id": "way/289299485" }, { "type": "Feature", "properties": { "@id": "way/296603967", "addr:city": "Saint Louis", "addr:housenumber": "225", "addr:postcode": "63108", "addr:state": "MO", "addr:street": "North Euclid Avenue", "amenity": "library", "building": "yes", "name": "St Louis Public Library (Schlafly Branch)" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2623814, 38.6443658 ], [ -90.262433, 38.6439956 ], [ -90.2624414, 38.6439351 ], [ -90.262492, 38.6435717 ], [ -90.2619608, 38.6435266 ], [ -90.2619695, 38.6434642 ], [ -90.2618466, 38.6434538 ], [ -90.2618316, 38.6435612 ], [ -90.2618514, 38.6435629 ], [ -90.2618302, 38.6437157 ], [ -90.2618142, 38.6437143 ], [ -90.2617953, 38.6438506 ], [ -90.2617806, 38.6438493 ], [ -90.2617743, 38.6438951 ], [ -90.2617543, 38.6438934 ], [ -90.2617331, 38.6440459 ], [ -90.2617741, 38.6440494 ], [ -90.2617701, 38.644078 ], [ -90.2617666, 38.6441031 ], [ -90.2617247, 38.6440995 ], [ -90.2616958, 38.6443076 ], [ -90.2623814, 38.6443658 ] ] ] }, "id": "way/296603967" }, { "type": "Feature", "properties": { "@id": "way/312990353", "addr:city": "St. Louis", "addr:housenumber": "2260", "addr:state": "MO", "addr:street": "South Vandeventer Avenue", "amenity": "library", "building": "yes", "name": "St. Louis Public Library", "operator": "Kingshighway Branch", "phone": "(314) 771-5450", "website": "slpl.org" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2669308, 38.6130308 ], [ -90.2671454, 38.6128694 ], [ -90.267124, 38.6128485 ], [ -90.2671293, 38.6128045 ], [ -90.2671132, 38.6127605 ], [ -90.267073, 38.6127311 ], [ -90.2670489, 38.6127227 ], [ -90.2670542, 38.6126661 ], [ -90.2667511, 38.6126389 ], [ -90.2667511, 38.6126682 ], [ -90.2666465, 38.6126661 ], [ -90.2666358, 38.6127835 ], [ -90.2667619, 38.6128108 ], [ -90.266794, 38.6129197 ], [ -90.2669308, 38.6130308 ] ] ] }, "id": "way/312990353" }, { "type": "Feature", "properties": { "@id": "way/381171329", "amenity": "library", "building": "yes", "name": "St Louis Public Library - Marketplace Branch" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2980592, 38.6191623 ], [ -90.2982745, 38.6190944 ], [ -90.2981774, 38.6189063 ], [ -90.297962, 38.6189741 ], [ -90.2980592, 38.6191623 ] ] ] }, "id": "way/381171329" }, { "type": "Feature", "properties": { "@id": "way/469784315", "addr:city": "Saint Louis", "addr:housenumber": "4401", "addr:postcode": "63109", "addr:state": "MO", "addr:street": "Hampton Avenue", "amenity": "library", "building": "yes", "building:levels": "3", "internet_access": "wlan", "internet_access:fee": "no", "internet_access:ssid": "SLPL", "name": "Saint Louis Public Library - Buder Branch", "operator": "Saint Louis Public Library", "website": "https://slpl.org" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2946939, 38.5906044 ], [ -90.2948005, 38.5906054 ], [ -90.2948003, 38.59064 ], [ -90.2949765, 38.590654 ], [ -90.2949414, 38.5902344 ], [ -90.2946643, 38.5902482 ], [ -90.2946939, 38.5906044 ] ] ] }, "id": "way/469784315" }, { "type": "Feature", "properties": { "@id": "way/483558495", "amenity": "library", "building": "yes", "building:levels": "7", "name": "Bernard Becker Medical Library" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2631001, 38.6349971 ], [ -90.2631734, 38.6346315 ], [ -90.2630074, 38.6346112 ], [ -90.2630133, 38.6345819 ], [ -90.2629081, 38.6345691 ], [ -90.262904, 38.6345889 ], [ -90.2626307, 38.6345544 ], [ -90.2626126, 38.6346521 ], [ -90.2625483, 38.6349567 ], [ -90.2626206, 38.6349656 ], [ -90.2626429, 38.6349683 ], [ -90.2626472, 38.6349467 ], [ -90.2628269, 38.6349686 ], [ -90.2628215, 38.6349957 ], [ -90.262939, 38.6350101 ], [ -90.2629454, 38.6349782 ], [ -90.2631001, 38.6349971 ] ] ] }, "id": "way/483558495" }, { "type": "Feature", "properties": { "@id": "way/532780313", "addr:city": "St. Louis", "addr:housenumber": "6800", "addr:postcode": "63111", "addr:state": "MO", "addr:street": "Michigan Avenue", "amenity": "library", "building": "yes", "building:levels": "2", "name": "Saint Louis Public Library - Carondelet Branch" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2544165, 38.5546792 ], [ -90.2542917, 38.5545911 ], [ -90.254281, 38.5546005 ], [ -90.2542488, 38.5545774 ], [ -90.2542032, 38.5546194 ], [ -90.2541845, 38.5546089 ], [ -90.2540356, 38.5547421 ], [ -90.2540798, 38.5547714 ], [ -90.254057, 38.5547966 ], [ -90.2541067, 38.5548281 ], [ -90.2540758, 38.5548574 ], [ -90.2541482, 38.5549099 ], [ -90.2542381, 38.5548344 ], [ -90.2542824, 38.5548637 ], [ -90.2543628, 38.5547977 ], [ -90.2543226, 38.554762 ], [ -90.2544165, 38.5546792 ] ] ] }, "id": "way/532780313" }, { "type": "Feature", "properties": { "@id": "way/563128910", "amenity": "library", "building": "yes" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.2214503, 38.614678 ], [ -90.2214626, 38.6146118 ], [ -90.2214912, 38.6146151 ], [ -90.2215212, 38.6144546 ], [ -90.2214953, 38.6144516 ], [ -90.2215072, 38.614388 ], [ -90.2213315, 38.614368 ], [ -90.2212773, 38.6146583 ], [ -90.2214503, 38.614678 ] ] ] }, "id": "way/563128910" }, { "type": "Feature", "properties": { "@id": "way/584699476", "addr:city": "Saint Louis", "addr:housenumber": "3309", "addr:postcode": "63118", "addr:state": "MO", "addr:street": "South Grand Boulevard", "amenity": "library", "building": "yes", "internet
				        	}
		        	}
		        });

		        button2.innerHTML = '<img style="max-width:100%; max-height:100%" src="img/overpass.png">';		  

		        container.title = "Query Overpass Turbo";

		        return container;
		    },
		    onRemove: function(map) {},
		});
		var control = new L.Control.Button()
		control.addTo(map);

		function onRightClick(e) {
			if( e.latlng.lat > 90 || e.latlng.lat < -90) {
				alert("Error in latitude");
				console.log("Error: not a valid coordinate");
			}
			else if( e.latlng.lng > 180 || e.latlng.lng < -180) {
				alert("Error in longitude"); 
				console.log("Error: not a valid coordinate"); 
			}
			else {
				console.log(e.latlng.toString()) }
		}

	</script>

</body>
</html>
